#!/bin/bash

#SBATCH --job-name=parsl.auto.1592007645.2225273
#SBATCH --output=/home/aymen/parsl_scripts/parsl.auto.1592007645.2225273.submit.stdout
#SBATCH --error=/home/aymen/parsl_scripts/parsl.auto.1592007645.2225273.submit.stderr
#SBATCH --nodes=1
#SBATCH --partition=debug
#SBATCH --time=10
#SBATCH --ntasks-per-node=1
#SBATCH --exclusive


source parsl-env/bin/activate

export JOBNAME="parsl.auto.1592007645.2225273"

export CORES=$(getconf _NPROCESSORS_ONLN)
echo "Found cores : $CORES"
WORKERCOUNT=1

CMD ( ) {
process_worker_pool.py --debug --max_workers=24 -p 0 -c 1 -m None --poll 10 --task_url=tcp://comet-ln2.sdsc.edu:50991 --result_url=tcp://comet-ln2.sdsc.edu:50729 --logdir=/home/aymen/parsl_scripts/comet_htex --block_id=0 --hb_period=30 --hb_threshold=120 
}
for COUNT in $(seq 1 1 $WORKERCOUNT)
do
    echo "Launching worker: $COUNT"
    CMD &
done
wait
echo "All workers done"

